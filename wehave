# æ·»åŠ ææ–™å’ŒæŸ¥è¯¢ææ–™

# å­—æ®µåˆå§‹å€¼
changes = {}


#åŠ è½½åŠŸèƒ½

import pickle
import os

#è¯»å–æ•°æ®
filename = 'wehave.data'
f = open(filename, 'rb')
wehave = pickle.load(f)

filename2 = 'danger.data'
f2 = open(filename2, 'rb')
danger = pickle.load(f2)


#å®šä¹‰åŠŸèƒ½

def read_data(name):
    filename = name + ".data"
    if os.path.exists(filename):
        f = open(filename, "rb")
        templs = pickle.load(f)


#æŸ¥çœ‹åŠŸèƒ½
def view():
    print("â‡ï¸  ç°æœ‰é£Ÿæï¼š\n______")
    newlist = list()
    for food, count in wehave.items():
        newlist.append((count,food))
    newlist = sorted(newlist,reverse=True)
    for count,food in newlist:
        if count > 0:
            print("ğŸ”˜",food,count)
    print("\nğŸˆ³ï¸ï¸ å·²ç¼ºå°‘é£Ÿæï¼š\n______")
    for count,food in newlist:
        if count == 0:
            print("ğŸ”˜",food,count)
    print("\nâš ï¸ å±é™©é£Ÿæï¼š\n______")
    for food,count in danger.items():
        print("ğŸ”˜",food,count)


#ç¡®è®¤åŠŸèƒ½
def check(ck,food,wehave_before,wehave_after):
    if len(ck) <1:
        wehave[food] = wehave_after
        print("âœ”ï¸ å·²å®Œæˆä¿®æ”¹")
        changes[food] = changes.get(food,0) + wehave_after - wehave_before
    elif ck == "n":
        wehave[food] = wehave_before
        print("ğŸŒ€ï¸ å·²æ’¤é”€")
    elif ck == "d":
        defood(wehave, food)
        print("âœ”ï¸âœ”ï¸ å·²åˆ é™¤è¯¥é£Ÿæ")
    else:
        wehave[food] = wehave_before
        print("ğŸŒ€ï¸ å·²æ’¤é”€")
    return ck
#æ·»åŠ åŠŸèƒ½
def addfood(food,n):
    wehave_before = wehave.get(food, 0)
    print("ä¹‹å‰:", food,wehave_before)
    wehave_after = wehave.get(food, 0) + n
    print("ğŸ’¬ å³å°†æ·»åŠ ï¼š",food,n)
    ck = input("ğŸ”” ç¡®å®šä¿®æ”¹ï¼Ÿï¼ˆå›è½¦:æ˜¯ï¼›n:å¦ï¼›d:åˆ é™¤é£Ÿæ):")
    check(ck,food, wehave_before, wehave_after)
    if ck == "1":
        print("ğŸ’¬ æ·»åŠ åï¼š",food,wehave[food])
    return wehave
#å‡å°‘åŠŸèƒ½
def redufood(food,n):
    wehave_before = wehave.get(food, 0)
    print("ä¹‹å‰ï¼š", food,wehave_before)
    wehave_after = wehave.get(food, 0) - n
    if wehave_after < 0:
        wehave_after = 0
    print("ğŸ’¬ å³å°†å‡å°‘ï¼š", food, n)
    ck = input("ğŸ”” ç¡®å®šä¿®æ”¹ï¼Ÿï¼ˆå›è½¦:æ˜¯ï¼›n:å¦ï¼›d:åˆ é™¤é£Ÿæ):")
    check(ck,food, wehave_before, wehave_after)
    if ck == "1":
        print("ğŸ’¬ å‡å°‘åï¼š",food,wehave[food])
    return wehave

#åˆ é™¤åŠŸèƒ½
def defood(d,key):
    if key in d:
        del d[key]
        return d

#æœ¬æ¬¡ä¿®æ”¹æƒ…å†µ
def thistime():
    print("\n_____æœ¬æ¬¡ä¿®æ”¹æƒ…å†µ_____")
    for food,count in changes.items():
        print(food,count)

#ä¿å­˜å˜é‡
def saveit():
    f = open(filename, 'wb')
    pickle.dump(wehave, f)
    f.close()

    f2 = open(filename2, 'wb')
    pickle.dump(danger, f2)
    f2.close()

    print("\nâœ… å·²å‚¨å­˜")

#åˆ é™¤å·²ç»æ²¡æœ‰çš„å±é™©é£Ÿå“

for food in list(danger.keys()):
    if food not in wehave or wehave[food]==0:
        defood(danger,food)
        print("ğŸ—‘ å·²è‡ªåŠ¨åˆ é™¤æ²¡æœ‰çš„å±é™©é£Ÿå“ï¼š",food)




#è¿è¡Œä¸»å¾ªç¯

while True:
    print("\n\n1:ğŸ“¥ æ·»åŠ ; 2:ğŸ—‘ å‡å°‘; 3:ğŸ” æŸ¥è¯¢; 4:âš ï¸ å±é™©é£Ÿæ; 5ï¼šâœ… ä¿å­˜å¹¶é€€å‡ºï¼›6ï¼šä¸ä¿å­˜é€€å‡º")
    choice = input("\nè¯·è¾“å…¥æŒ‡ä»¤:")
    try:
        choice = int(choice)
    except:
        print("â—ï¸æŒ‡ä»¤é”™è¯¯ï¼Œè¯·è¾“å…¥æ•°å­—åºå·")
        continue
    if choice == 1:
        #å±•ç¤ºåºå·
        print("â‡ï¸ ç°æœ‰é£Ÿæï¼š\n______")
        temp = list()
        for food in wehave.keys():
            temp.append(food)
            print(temp.index(food) + 1, food)
        # è¾“å…¥æ·»åŠ çš„é£Ÿæ
        print("\n---å¼€å§‹æ·»åŠ ---\n")
        ch = input("è¯·è¾“å…¥æ·»åŠ çš„é£Ÿæåæˆ–åºå·ï¼š")
        try:
            ch = int(ch) - 1
            food = temp[ch]
        except:
            food = ch
        #è¾“å…¥å¢åŠ 
        n = input("è¾“å…¥æ·»åŠ  {} çš„æ•°é‡ï¼š".format(food))
        try:
            n = int(n)
        except:
            print("â—ï¸æŒ‡ä»¤é”™è¯¯")
            continue
        #æ‰§è¡Œæ·»åŠ 
        addfood(food,n)
    elif choice == 2:
        #å±•ç¤ºç°æœ‰é£Ÿæå’Œåºå·
        print("â‡ï¸ ç°æœ‰é£Ÿæï¼š\n______")
        temp = list()
        for food,count in wehave.items():
            temp.append(food)
            print(temp.index(food) + 1, food,count)
        #è¾“å…¥å‡å°‘å†…å®¹
        print("\n---å¼€å§‹å‡å°‘---\n")
        ch = input("è¯·è¾“å…¥å‡å°‘çš„é£Ÿæåºå·ï¼š")
        try:
            ch = int(ch) - 1
            food = temp[ch]
        except:
            print("â—ï¸æŒ‡ä»¤é”™è¯¯")
            continue
        print(food,"ç°æœ‰ï¼š",wehave[food])
        n = input("è¾“å…¥å‡å°‘æ•°é‡ï¼ˆdefaultï¼šallï¼‰ï¼š")
        try:
            n = int(n)
        except:
            n = wehave[food]
        #å¼€å§‹å‡å°‘
        redufood(food,n)
    elif choice == 3:
        print("ğŸ” æ­£åœ¨æŸ¥è¯¢...\n...")
        view()
    elif choice == 4:
        print("\nâš ï¸ å±é™©é£Ÿæï¼š\n_______")
        for (food,count) in danger.items():
            print(food,count)
        while True:
            food = input("\nè¯·è¾“å…¥è¦æ·»åŠ çš„å±é™©é£Ÿæï¼š")
            if len(food)==0:
                print("æ— ")
                break
            else:
                if food not in wehave.keys() or wehave[food]==0:
                    print("â—ï¸è¯¥é£Ÿæä¸åœ¨ç°æœ‰é£Ÿæåˆ—è¡¨ä¸­ï¼è¯·å…ˆæ·»åŠ ")
                    print("---å¼€å§‹æ·»åŠ ---")
                    n = input("è¾“å…¥ "+food+" çš„æ·»åŠ æ•°é‡ï¼š")
                    try:
                        n = int(n)
                    except:
                        print("â—ï¸æŒ‡ä»¤é”™è¯¯3"
                              "")
                        continue
                    addfood(food, n)
                #danger[food]=danger.get(food,0)
                danger[food]=wehave[food]
                print("ğŸ’¬ å·²æ·»åŠ å±é™©é£Ÿå“ï¼š", food)
        while True:
            food = input("\nè¯·è¾“å…¥è¦ç§»é™¤çš„å±é™©é£Ÿæï¼š")
            if len(food)==0:
                print("æ— ")
                break
            else:
                defood(danger,food)
                print("ğŸ’¬ å·²åˆ é™¤å±é™©é£Ÿå“ï¼š",food)
    elif choice == 5:
        thistime()
        saveit()
        break
    elif choice == 6:
        print("æœªä¿å­˜ï¼Œç»“æŸã€‚")
        break
    else:
        print("â—ï¸æŒ‡ä»¤é”™è¯¯ï¼Œè¯·é‡æ–°è¾“å…¥")
        continue
