# é£Ÿè°±å¯¹åº”é£Ÿæçš„åˆ—è¡¨

import pickle
import os

ingrs = []
temp = []

# åˆå§‹åŒ–
def initialize():
    menu = {}  #åˆå§‹å€¼
    saveit(menu, "menu")
    print("âœ… å·²å®Œæˆåˆå§‹åŒ–")

#è¯»å–æ•°æ®æ–‡ä»¶ï¼Œå¹¶ç”Ÿæˆä¸´æ—¶å˜é‡ tempdata
def readdata(valuename):
    filename =  valuename + ".data"
    if os.path.exists(filename):
        f = open(filename, "rb")
        tempdata = pickle.load(f)
        return tempdata
    else:
        print("â—ï¸ no such file:%s", filename)
        initialize()
        f = open(filename, "rb")
        tempdata = pickle.load(f)
        return tempdata


#ä¿å­˜å˜é‡çš„åŒåæ•°æ®æ–‡ä»¶
def saveit(vir,name):
    filename = name + ".data"
    f = open(filename, 'wb')
    pickle.dump(vir, f)
    f.close()
    print("å·²ä¿å­˜")



# ç”¨å­—å…¸ç”Ÿæˆå…¨éƒ¨å…ƒç´ (æœ‰åº“å­˜çš„ï¼‰çš„å¤§å­—å…¸:allfood
def getallitems(var):
    allfood = {} #æ–°å»ºä¸´æ—¶é£Ÿæåˆ—è¡¨
    for cate,foods in var.items():
        for k,v in foods.items():
            if v > 0:
                allfood[k] = v
            else:continue
    return allfood

#å±•ç¤ºå¸¦åºå·çš„å­—å…¸keyï¼Œå¹¶ç”Ÿæˆä¸´æ—¶æ–°åˆ—è¡¨tempix
def dicttols(ordir):
    tempix = list()
    for ls in ordir.keys():
        tempix.append(ls)
        print(tempix.index(ls) + 1, ls)
    return tempix

#ä»æ–°ç”Ÿæˆçš„åˆ—è¡¨ä¸­ï¼Œç”¨åç§°æˆ–åºå·é€‰æ‹©å‡ºkeyåç§°ï¼šname
def askch(tempix):
    ch = input(" \nè¯·é€‰æ‹©é¡¹ç›®æˆ–è¾“å…¥ï¼ˆå›è½¦é€€å‡ºï¼‰ï¼š")
    if len(ch)==0:
        print("æœªè¾“å…¥ï¼Œè·³å‡ºã€‚")
    try:
        name = tempix[int(ch) - 1]
    except:
        name = ch
    return name

#åˆ é™¤å­—å…¸ä¸­çš„keyåŠŸèƒ½
def dekey(d,key):
    if key in d:
        del d[key]
        return d



menu = readdata("menu")
freshfood = readdata("freshfood")
allfood = getallitems(freshfood)

while True :
    print("\n1:æ·»åŠ èœè°±ï¼›2:ä¿®æ”¹èœè°±ï¼›3:èœè°±ç²¾äº²æµ‹ï¼›4ï¼šé€€å‡º")
    choice = input("è¯·è¾“å…¥æŒ‡ä»¤ï¼š")
    try:
        choice = int(choice)
    except:
        continue
    if choice == 1:
        dish = input("è¯·è¾“å…¥èœåï¼š")
        while True:
            ingr = input("è¯·è¾“å…¥é£Ÿæï¼ˆe ç»“æŸï¼‰ï¼š")
            if len(ingr) == 0:break
            if ingr == "e":break
            ingrs.append(ingr)
            print("âœ”ï¸ å·²æ·»åŠ é£Ÿæï¼š",ingr)
        menu[dish]=ingrs
        saveit(menu,"menu")
    elif choice == 2:
        print("å¼€å§‹ä¿®æ”¹èœè°±")
        tempix = dicttols(menu)
        dish = askch(tempix)
        print("å¼€å§‹ä¿®æ”¹èœè°±ï¼š",dish)
        for i in menu[dish]:
            print("ğŸ”˜",i)
        ch = input("è¯·è¾“å…¥ï¼ˆ1:æ·»åŠ é£Ÿæï¼›2ï¼šåˆ é™¤é£Ÿæï¼›3ï¼šèœè°±æ”¹åï¼›4ï¼šåˆ é™¤èœè°±ï¼‰ï¼š")
        try:
            ch = int(ch)
        except:
            continue
        if ch == 1:
            while True:
                food = input("è¦åœ¨èœè°±ä¸­æ·»åŠ çš„é£Ÿæï¼š")
                if len(food) == 0:
                    print("æœªè¾“å…¥ï¼Œä¸­æ–­ã€‚")
                    break
                menu[dish].append(food)
                saveit(menu, "menu")
                print("âœ”ï¸ å·²æ·»åŠ ï¼š", food, " åˆ°èœè°±", dish)
        elif ch == 2:
            food = input("è¦åœ¨èœè°±ä¸­åˆ é™¤çš„é£Ÿæï¼š")
            if len(food) == 0:
                print("æœªè¾“å…¥ï¼Œä¸­æ–­ã€‚")
                continue
            menu[dish].remove(food)
            saveit(menu,"menu")
            print("å·²åˆ é™¤ï¼š", food, " ä»èœè°±", dish)
        elif ch == 3:
            print("åŸèœåä¸ºï¼š",dish)
            newdish = input("è¯·è¾“å…¥æ–°åç§°ï¼š")
            if len(newdish) == 0:
                continue
            menu[newdish]= menu[dish]
            dekey(menu, dish)
            if newdish in menu.keys():
                saveit(menu, "menu")
                print("å·²ä¿®æ”¹", dish, "â†’", newdish)
            else:
                print("ä¿®æ”¹å¤±è´¥")
                continue
        elif ch == 4:
            ck = input("ç¡®å®šåˆ é™¤ï¼ˆyï¼šæ˜¯ï¼›å…¶ä»–ä»»æ„é”®ï¼šæ’¤é”€ï¼‰ï¼š")
            if ck == "y":
                dekey(menu,dish)
                if dish not in menu.keys():
                    saveit(menu,"menu")
                    print("å·²åˆ é™¤ï¼š",dish)
                else:
                    print("åˆ é™¤å¤±è´¥")
                    continue
        else:continue
    elif choice == 3:
        tempix = dicttols(menu)
        dish = askch(tempix)
        if len(dish) == 0:
            print("â—ï¸ æœªè¾“å…¥ï¼Œä¸­æ–­")
            continue
        ls_y = []  #ä¸´æ—¶list
        ls_n = []  #ä¸´æ—¶list
        for i in menu[dish]:
            if i in allfood.keys():
                ls_y.append(i)
            else:
                ls_n.append(i)
        print("åˆ¶ä½œ ",dish)
        print("â€”â€”â€”â€”â€”â€”â€”â€”å·²æœ‰ä»¥ä¸‹é£Ÿæâ€”â€”â€”â€”â€”â€”â€”â€”â€”â€”")
        for i in ls_y:
            tplt = "{0:<2}{1:{3}<8}\t{2:<3}"
            print(tplt.format("ğŸ”˜", i, str(allfood[i]), chr(12288)))
        print("â€”â€”â€”â€”â€”â€”â€”â€”è¯·ç¡®è®¤æœ‰ä»¥ä¸‹é£Ÿæâ€”â€”â€”â€”â€”â€”")
        for i in ls_n:
            print("ğŸš«",i)
    elif choice == 4:
        print("ç»“æŸ")
        break
    else:
        print("è¯·è¾“å…¥æŒ‡ä»¤å¯¹åº”æ•°å­—")
        continue


